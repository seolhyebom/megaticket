# MegaTicket DynamoDB Schema Documentation

> **ë¬¸ì„œ ë²„ì „**: V7.16  
> **ìµœì¢… ìˆ˜ì •**: 2026-01-01  
> **ì‘ì„±ì**: Antigravity (AI ì–´ì‹œìŠ¤í„´íŠ¸)  
> **AWS ë¦¬ì „**: ap-northeast-2 (ê¸°ë³¸ê°’, `AWS_REGION` í™˜ê²½ë³€ìˆ˜ë¡œ ë³€ê²½ ê°€ëŠ¥)  
> **í…Œì´ë¸” ì ‘ë‘ì‚¬**: `KDT-Msp4-PLDR-*` (ê¸°ë³¸ê°’, `DYNAMODB_*_TABLE` í™˜ê²½ë³€ìˆ˜ë¡œ ë³€ê²½ ê°€ëŠ¥)  
> **ë°ì´í„° ì¶œì²˜**: AWS DynamoDB ì‹¤ì œ Scan ì¡°íšŒ ê²°ê³¼ ê¸°ë°˜ (2026-01-01)

---

## ğŸ“‹ ëª©ì°¨

1. [í…Œì´ë¸” ê°œìš”](#-í…Œì´ë¸”-ê°œìš”)
2. [performances í…Œì´ë¸”](#-performances-í…Œì´ë¸”)
3. [reservations í…Œì´ë¸”](#-reservations-í…Œì´ë¸”)
4. [schedules í…Œì´ë¸”](#-schedules-í…Œì´ë¸”)
5. [venues í…Œì´ë¸”](#-venues-í…Œì´ë¸”)
6. [í…Œì´ë¸” ê°„ ê´€ê³„](#-í…Œì´ë¸”-ê°„-ê´€ê³„)
7. [í‚¤ ìƒì„± í•¨ìˆ˜](#-í‚¤-ìƒì„±-í•¨ìˆ˜)
8. â­ [TTL (Time To Live) ìƒì„¸](#-ttl-time-to-live-ìƒì„¸)
9. [í™˜ê²½ë³€ìˆ˜](#ï¸-í™˜ê²½ë³€ìˆ˜)
10. [ë°ì´í„° íƒ€ì… ë²”ë¡€](#-ë°ì´í„°-íƒ€ì…-ë²”ë¡€)
11. [ì½”ë“œì™€ DB í•„ë“œëª… ì°¨ì´](#ï¸-ì½”ë“œì™€-db-í•„ë“œëª…-ì°¨ì´)
12. [ì£¼ìš” ì¿¼ë¦¬ íŒ¨í„´](#-ì£¼ìš”-ì¿¼ë¦¬-íŒ¨í„´)
13. [ê°œì„  ì™„ë£Œ ì‚¬í•­](#-ê°œì„ -ì™„ë£Œ-ì‚¬í•­)
14. â­ [ì¸ë©”ëª¨ë¦¬ ìºì‹± ì „ëµ](#-ì¸ë©”ëª¨ë¦¬-ìºì‹±-ì „ëµ)
15. [DR_RECOVERED ìƒíƒœ ìƒì„¸](#-dr_recovered-ìƒíƒœ-ìƒì„¸)
16. â­ [GSI (Global Secondary Index) ì¸í”„ë¼ ì„¤ì •](#-gsi-global-secondary-index-ì¸í”„ë¼-ì„¤ì •)
17. â­ [ë¹„ì •ê·œí™” (Denormalization) ì „ëµ](#-ë¹„ì •ê·œí™”-denormalization-ì „ëµ)
18. â­ [Global Tables (DR ë³µì œ) ì„¤ì • í˜„í™©](#-global-tables-dr-ë³µì œ-ì„¤ì •-í˜„í™©)
19. â­ [ì¸í”„ë¼ ì²´í¬ë¦¬ìŠ¤íŠ¸](#-ì¸í”„ë¼-ì²´í¬ë¦¬ìŠ¤íŠ¸-2025-12-28-ì™„ë£Œ)

### ğŸ—ï¸ ì¸í”„ë¼ ê´€ë ¨ ì„¹ì…˜ (AWS Best Practice)

| ì„¹ì…˜ | ì£¼ìš” ë‚´ìš© |
|------|----------|
| â­ 8. TTL ìƒì„¸ | ìë™ ì‚­ì œ ì„¤ì •, holdExpiresAt 60ì´ˆ |
| â­ 14. ì¸ë©”ëª¨ë¦¬ ìºì‹± | 7ì¼ TTL, RCU 99%+ ì ˆê° |
| â­ 16. GSI ì¸í”„ë¼ ì„¤ì • | userId-index, ë¹„ìš© ìµœì í™” |
| â­ 17. ë¹„ì •ê·œí™” ì „ëµ | JOIN ì—†ì´ ë‹¨ì¼ ì¿¼ë¦¬, ì½ê¸° ë¹„ìš© ì ˆê° |
| â­ 18. Global Tables | ë„ì¿„ DR ë³µì œ, ìë™ ë™ê¸°í™” |
| â­ 19. ì¸í”„ë¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ | ì™„ë£Œ ìƒíƒœ í™•ì¸ |

---

## ğŸ“‹ í…Œì´ë¸” ê°œìš”

| í…Œì´ë¸”ëª… | íŒŒí‹°ì…˜ í‚¤ | ì •ë ¬ í‚¤ | TTL í•„ë“œ | ìš©ë„ |
|---------|----------|--------|---------|------|
| KDT-Msp4-PLDR-performances | performanceId (S) | - | - | ê³µì—° ë§ˆìŠ¤í„° ë°ì´í„° |
| KDT-Msp4-PLDR-reservations | PK (S) | SK (S) | ttl, holdExpiresAt | ì¢Œì„ ì„ ì /ì˜ˆì•½ íŠ¸ëœì­ì…˜ |
| KDT-Msp4-PLDR-schedules | scheduleId (S) | - | - | ê³µì—° íšŒì°¨ ì •ë³´ |
| KDT-Msp4-PLDR-venues | venueId (S) | - | - | ê³µì—°ì¥ ë§ˆìŠ¤í„° ë°ì´í„° |

---

## ğŸ“¦ performances í…Œì´ë¸”

### ëª©ì 
ê³µì—°ì˜ **ë§ˆìŠ¤í„° ë°ì´í„°**ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”.  
- ê³µì—° ì œëª©, ì„¤ëª…, ê³µì—° ê¸°ê°„, í¬ìŠ¤í„° ì´ë¯¸ì§€ ë“± ê³µì—° ê¸°ë³¸ ì •ë³´
- **ì¢Œì„ ë“±ê¸‰ë³„ ê°€ê²© ì •ë³´** (`seatGrades`) - ì±—ë´‡ ê°€ê²© ì¡°íšŒì˜ SSOT
- **ì¶œì—°ì§„ ì •ë³´** (`cast`) - ì—­í• ë³„ ë°°ìš° ëª©ë¡
- **OPì„ íŒë§¤ ì—¬ë¶€** (`hasOPSeats`) - ê³µì—°ë³„ OPì„ ì¡´ì¬ ì—¬ë¶€ ê²°ì •

### ì£¼ìš” ì‚¬ìš©ì²˜
- ì±—ë´‡: `get_performances`, `get_performance_details`, `get_seat_grades` ë„êµ¬
- í”„ë¡ íŠ¸ì—”ë“œ: ê³µì—° ëª©ë¡ í˜ì´ì§€, ê³µì—° ìƒì„¸ í˜ì´ì§€

### í‚¤ êµ¬ì¡°
- **Partition Key**: `performanceId` (String)

### ì‹¤ì œ DB í•„ë“œ (Scan ì¡°íšŒ ê²°ê³¼)

| í•„ë“œëª… | DynamoDB íƒ€ì… | ì‹¤ì œ ì˜ˆì‹œê°’ | ì„¤ëª… |
|-------|--------------|------------|------|
| `performanceId` | S | `perf-kinky-1` | ê³µì—° ê³ ìœ  ID **(PK)** |
| `title` | S | `í‚¹í‚¤ë¶€ì¸ ` | ê³µì—° ì œëª© |
| `description` | S | `ì‹ ë”” ë¡œí¼ ì‘ê³¡ì˜ ê°ë™ì ì¸ ë¸Œë¡œë§¨ìŠ¤...` | ê³µì—° ì„¤ëª… |
| `venue` | S | (venues.name ì°¸ì¡° ë¹„ì •ê·œí™”) | ê³µì—°ì¥ëª… |
| `venueId` | S | `charlotte-theater` | ê³µì—°ì¥ ID (FK â†’ venues) |
| `posterUrl` | S | `/posters/kinky.jpg` | í¬ìŠ¤í„° ì´ë¯¸ì§€ ê²½ë¡œ |
| `dateRange` | S | `2026.02.10 ~ 2026.04.30` | ê³µì—° ê¸°ê°„ |
| `price` | S | `OPì„ 170,000ì› / Rì„ 140,000ì›...` | ê°€ê²© ì•ˆë‚´ í…ìŠ¤íŠ¸ (UI í‘œì‹œìš©) |
| `hasOPSeats` | BOOL | `true` | OPì„ íŒë§¤ ì—¬ë¶€ |
| `seatGrades` | L (List) | (ì•„ë˜ ì°¸ì¡°) | ì¢Œì„ ë“±ê¸‰/ê°€ê²© ë°°ì—´ **(SSOT)** |
| `seatColors` | M (Map) | `{"VIP": "#FF0000", "R": "#FFA500"...}` | ì¢Œì„ ë°°ì¹˜ë„ ìƒ‰ìƒ |
| `cast` | M (Map) | (ì•„ë˜ ì°¸ì¡°) | ì¶œì—°ì§„ ì •ë³´ (ì—­í• ë³„ ë°°ìš°) |
| `createdAt` | S | `2025-12-23T01:47:07.861Z` | ìƒì„±ì¼ì‹œ (ISO 8601) |

### seatGrades í•„ë“œ êµ¬ì¡° (DB ì‹¤ì œ ë°ì´í„°)

> âš ï¸ **SSOT**: ì±—ë´‡ì—ì„œ ì¢Œì„ ë“±ê¸‰/ê°€ê²© ì •ë³´ë¥¼ ì‘ë‹µí•  ë•Œ ì´ ë°ì´í„°ë¥¼ ì§ì ‘ ì‚¬ìš©í•´ì•¼ í•¨. í•˜ë“œì½”ë”© ê¸ˆì§€!

```json
{
  "seatGrades": [
    {
      "grade": "VIP",
      "price": 170000,
      "color": "#FF0000",
      "description": "1ì¸µ ì •ì¤‘ì•™ ì•ìª½, ìµœê³ ì˜ ì‹œì•¼"
    },
    {
      "grade": "R",
      "price": 140000,
      "color": "#FFA500"
    },
    {
      "grade": "S",
      "price": 110000,
      "color": "#1E90FF"
    },
    {
      "grade": "A",
      "price": 80000,
      "color": "#32CD32"
    },
    {
      "grade": "OP",
      "price": 170000,
      "color": "#9E37D1"
    }
  ]
}
```

### cast í•„ë“œ êµ¬ì¡° (DB ì‹¤ì œ ë°ì´í„°)

> âš ï¸ **íƒ€ì…**: Map (M) - ì—­í• ëª…(key)ì— ë°°ìš°ëª… ë°°ì—´(value) êµ¬ì¡°

```json
{
  "cast": {
    "charlie": ["ê¹€í˜¸ì˜", "ì‹ ì¬ë²”", "ì´ì¬í™˜"],
    "lola": ["ì„œê²½ìˆ˜", "ê°•í™ì„", "ë°±í˜•í›ˆ"],
    "lauren": ["í•œì¬ì•„", "í—ˆìœ¤ìŠ¬"],
    "don": ["ì‹¬ì¬í˜„", "ì‹ ìŠ¹í™˜", "ê¹€ë™í˜„"],
    "nicola": ["ì´ë£¨ì›", "ìœ ì£¼ì—°"]
  }
}
```

---

## ğŸ“¦ reservations í…Œì´ë¸”

### ëª©ì 
**ì¢Œì„ ì„ ì (Holding)ê³¼ ì˜ˆì•½(Reservation)ì˜ íŠ¸ëœì­ì…˜ ìƒíƒœ**ë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ í…Œì´ë¸”.
- **ì¢Œì„ 1ê°œ = ë ˆì½”ë“œ 1ê°œ** êµ¬ì¡° (Nëª… ì˜ˆì•½ ì‹œ Nê°œ ë ˆì½”ë“œ ìƒì„±)
- ì„ ì  ì‹œ 60ì´ˆ TTL ì„¤ì •, ì‹œê°„ ì´ˆê³¼ ì‹œ DynamoDB TTLë¡œ ìë™ ì‚­ì œ
- ì˜ˆì•½ ì·¨ì†Œ ì‹œ 7ì¼ê°„ ë³´ì¡´ í›„ ìë™ ì‚­ì œ (ì‚¬ìš©ì ì´ë ¥ ì¡°íšŒìš©)
- **DR_RECOVERED**: Main ë¦¬ì „ì—ì„œ HOLDING ì¤‘ ì¥ì•  ë°œìƒ â†’ DR ë¦¬ì „ì—ì„œ 15ë¶„ ìœ ì˜ˆë¡œ ë³µêµ¬
- **DR_RESERVED**: DR ë¦¬ì „ì—ì„œ ìƒˆë¡œ ì˜ˆì•½í•œ ê±´ (ì˜êµ¬ ë³´ì¡´)

### ì£¼ìš” ì‚¬ìš©ì²˜
- ì±—ë´‡: `hold_seats`, `confirm_reservation`, `cancel_reservation`, `get_user_reservations`
- ì¢Œì„ ë°°ì¹˜ë„: `getSeatStatusMap()` - íŒë§¤ëœ/ì„ ì ì¤‘/ì˜ˆë§¤ê°€ëŠ¥ ì¢Œì„ í‘œì‹œ
- ê´€ë¦¬ì: ì˜ˆì•½ í˜„í™© ì¡°íšŒ

### í‚¤ êµ¬ì¡°
- **Partition Key**: `PK` (String) - í˜•ì‹: `PERF#{performanceId}#{date}#{time}`
- **Sort Key**: `SK` (String) - í˜•ì‹: `SEAT#{seatId}`

> ğŸ“ **í‚¤ ì„¤ê³„ ì˜ë„**: ë™ì¼ íšŒì°¨(ê³µì—°+ë‚ ì§œ+ì‹œê°„)ì˜ ëª¨ë“  ì¢Œì„ì„ í•œ ë²ˆì˜ Queryë¡œ ì¡°íšŒ ê°€ëŠ¥

### TTL (Time To Live) ì„¤ì •

| ìƒíƒœ | TTL í•„ë“œ | ë§Œë£Œ ì‹œê°„ | ë™ì‘ |
|-----|---------|----------|------|
| **HOLDING** | `holdExpiresAt` | **60ì´ˆ** | ë§Œë£Œ ì‹œ DynamoDB ìë™ ì‚­ì œ (ì¢Œì„ í•´ì œ) |
| **DR_RECOVERED** | `ttl` | **15ë¶„** | Mainì—ì„œ HOLDING ì¤‘ ì¥ì•  â†’ DRì—ì„œ ë³µêµ¬, 15ë¶„ í›„ ìë™ ì‚­ì œ |
| **CANCELLED** | `ttl` | **7ì¼** | ì·¨ì†Œ í›„ 7ì¼ê°„ ë³´ì¡´ (ì‚¬ìš©ì ì´ë ¥), ì´í›„ ìë™ ì‚­ì œ |
| **CONFIRMED** | - | ì—†ìŒ | ì˜êµ¬ ë³´ì¡´ - Main(ì„œìš¸) ë¦¬ì „ ì˜ˆì•½ |
| **DR_RESERVED** | - | ì—†ìŒ | ì˜êµ¬ ë³´ì¡´ - DR(ë„ì¿„) ë¦¬ì „ ì˜ˆì•½ |

> âš ï¸ **TTL í™˜ê²½ë³€ìˆ˜**: `CANCELLED_RETENTION_DAYS=7` (ê¸°ë³¸ê°’ 7ì¼)

### ì‹¤ì œ DB í•„ë“œ (Scan ì¡°íšŒ ê²°ê³¼)

| í•„ë“œëª… | DynamoDB íƒ€ì… | ì‹¤ì œ ì˜ˆì‹œê°’ | ì„¤ëª… |
|-------|--------------|------------|------|
| `PK` | S | `PERF#perf-phantom-1#2026-03-05#19:30` | íŒŒí‹°ì…˜ í‚¤ |
| `SK` | S | `SEAT#1ì¸µ-B-7-6` | ì •ë ¬ í‚¤ |
| `status` | S | `CONFIRMED` | ìƒíƒœê°’ (ì•„ë˜ ìƒíƒœ íë¦„ ì°¸ì¡°) |
| `holdingId` | S | `6a7a-fd9f-4452-9e3b-89dc90f8aeaf` | ì„ ì  ID (UUID, HOLDING ì‹œ ìƒì„±) |
| `reservationId` | S | `770e-xxxx-xxxx-xxxx` | ì˜ˆì•½ ID (UUID, CONFIRMED ì‹œ ìƒì„±) |
| `userId` | S | `visitor-abc123` | ì‚¬ìš©ì ì‹ë³„ì (visitorId) |
| `performanceId` | S | `perf-phantom-1` | ê³µì—° ID |
| `performanceTitle` | S | `ì˜¤í˜ë¼ì˜ ìœ ë ¹` | ê³µì—°ëª… (ë¹„ì •ê·œí™”, CONFIRMED ì‹œ ì €ì¥) |
| `venue` | S | `ìƒ¤ë¡¯ë°ì”¨ì–´í„°` | ê³µì—°ì¥ëª… (ë¹„ì •ê·œí™”) |
| `posterUrl` | S | `/posters/opera.png` | í¬ìŠ¤í„° URL (ë¹„ì •ê·œí™”) |
| `date` | S | `2026-03-05` | ê³µì—° ë‚ ì§œ (YYYY-MM-DD) |
| `time` | S | `19:30` | ê³µì—° ì‹œê°„ (HH:MM) |
| `seatId` | S | `1ì¸µ-B-5-8` | ì¢Œì„ ID |
| `seatNumber` | N | `8` | ì¢Œì„ ë²ˆí˜¸ |
| `rowId` | S | `5` | ì—´ ID (ìˆ«ì ë˜ëŠ” "OP") |
| `grade` | S | `VIP` | ì¢Œì„ ë“±ê¸‰ |
| `price` | N | `170000` | ì¢Œì„ ê°€ê²© (ì›) |
| `createdAt` | S | `2025-12-28T05:10:00.000Z` | ìƒì„± ì‹œê°„ (ISO 8601) |
| `expiresAt` | S | `2025-12-28T05:11:00.000Z` | ë§Œë£Œ ì‹œê°„ (HOLDINGìš©, ISO 8601) |
| `confirmedAt` | S | `2025-12-28T05:10:30.000Z` | ì˜ˆì•½ í™•ì • ì‹œê°„ |
| `cancelledAt` | S | `2025-12-28T06:00:00.000Z` | ì·¨ì†Œ ì‹œê°„ |
| `holdExpiresAt` | N | `1735365060` | **TTL í•„ë“œ** (Unix timestamp, HOLDING 60ì´ˆ) |
| `ttl` | N | `1735969860` | **TTL í•„ë“œ** (Unix timestamp, CANCELLED 7ì¼) |
| `sourceRegion` | S | `ap-northeast-2` | ì˜ˆì•½ ìƒì„± ë¦¬ì „ (ì•„ë˜ ìƒì„¸ ì„¤ëª… ì°¸ì¡°) |

### sourceRegion í•„ë“œ ìƒì„¸

> âš ï¸ **ì£¼ì˜**: ì´ í•„ë“œëŠ” **V7.16 ì´í›„ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ì˜ˆì•½**ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ê¸°ì¡´ ì˜ˆì•½ì—ëŠ” ì—†ìŠµë‹ˆë‹¤.

| ê°’ | ì˜ë¯¸ | í™˜ê²½ |
|----|------|------|
| `ap-northeast-2` | ì„œìš¸ ë¦¬ì „ì—ì„œ ìƒì„±ëœ ì˜ˆì•½ | Main (ì •ìƒ ìš´ì˜) |
| `ap-northeast-1` | ë„ì¿„ ë¦¬ì „ì—ì„œ ìƒì„±ëœ ì˜ˆì•½ | DR (ì¥ì•  ë³µêµ¬) |

**ìš©ë„**: DR ë³µêµ¬ í›„ "ì´ ì˜ˆì•½ì´ ì–´ëŠ ë¦¬ì „ì—ì„œ ìƒì„±ë˜ì—ˆëŠ”ì§€" ì¶”ì í•˜ì—¬ ìš´ì˜íŒ€ì´ Main/DR ì˜ˆì•½ì„ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¹„ì •ê·œí™” í•„ë“œ ì„¤ëª…

> ğŸ“ **ë¹„ì •ê·œí™”(Denormalization)**: DynamoDBëŠ” JOINì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ, ìì£¼ í•¨ê»˜ ì¡°íšŒë˜ëŠ” ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.

| ë¹„ì •ê·œí™” í•„ë“œ | ì›ë³¸ í…Œì´ë¸” | ì €ì¥ ì‹œì  | ëª©ì  |
|--------------|-------------|----------|------|
| `performanceTitle` | performances.title | CONFIRMED ì‹œ | ë§ˆì´í˜ì´ì§€ì—ì„œ ê³µì—°ëª… ì¦‰ì‹œ í‘œì‹œ |
| `venue` | venues.name | CONFIRMED ì‹œ | ë§ˆì´í˜ì´ì§€ì—ì„œ ê³µì—°ì¥ëª… ì¦‰ì‹œ í‘œì‹œ |
| `posterUrl` | performances.posterUrl | CONFIRMED ì‹œ | ë§ˆì´í˜ì´ì§€ì—ì„œ í¬ìŠ¤í„° ì¦‰ì‹œ í‘œì‹œ |

**ì¥ì **: ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ ì‹œ **ë‹¨ì¼ Query**ë¡œ ì™„ì „í•œ ë°ì´í„° íšë“ (performances, venues ì¶”ê°€ ì¡°íšŒ ë¶ˆí•„ìš”)

**ë‹¨ì **: ì›ë³¸ ë°ì´í„° ë³€ê²½ ì‹œ ë™ê¸°í™” í•„ìš” (ê³µì—° ì •ë³´ëŠ” ê±°ì˜ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¬´ì‹œ ê°€ëŠ¥)

### ìƒíƒœ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì¢Œì„ ì˜ˆì•½ í”Œë¡œìš°                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [ì¢Œì„ ì„ íƒ] (hold_seats í˜¸ì¶œ)                                   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ HOLDING â”‚  â† holdExpiresAt = í˜„ì¬ì‹œê°„ + 60ì´ˆ                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                    â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€â”€â”€â”€â”€ 60ì´ˆ ê²½ê³¼ â”€â”€â”€â”€â†’ [DynamoDB TTL ìë™ ì‚­ì œ] (ì¢Œì„ í•´ì œ) â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”‚ confirm_reservation í˜¸ì¶œ                                â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚ CONFIRMED â”‚  â† ì˜êµ¬ ë³´ì¡´ (ì·¨ì†Œ ì „ê¹Œì§€)                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚        â”‚                                                        â”‚
â”‚        â”‚ cancel_reservation í˜¸ì¶œ                                â”‚
â”‚        â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚ CANCELLED â”‚  â† ttl = í˜„ì¬ì‹œê°„ + 7ì¼                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚        â”‚                                                        â”‚
â”‚        â””â”€â”€â”€â”€â”€ 7ì¼ ê²½ê³¼ â”€â”€â”€â”€â†’ [DynamoDB TTL ìë™ ì‚­ì œ]             â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               DR ë¦¬ì „ ì‹ ê·œ ì˜ˆì•½ í”Œë¡œìš° (ë„ì¿„)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [Main ì¥ì•  ë°œìƒ] â†’ [DR ë¦¬ì „ìœ¼ë¡œ Failover]                        â”‚
â”‚       â”‚               DR_RECOVERY_MODE=true                     â”‚
â”‚       â–¼                                                         â”‚
â”‚  [ìƒˆ ì¢Œì„ ì„ íƒ] (hold_seats í˜¸ì¶œ)                                 â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ HOLDING â”‚  â† holdExpiresAt = í˜„ì¬ì‹œê°„ + 60ì´ˆ                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                    â”‚
â”‚       â”‚ confirm_reservation í˜¸ì¶œ                                â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ DR_RESERVED â”‚  â† DR ë¦¬ì „ì—ì„œ ìƒˆë¡œ ì˜ˆì•½í•œ ê±´ (ì˜êµ¬ ë³´ì¡´)         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ì¥ì•  ë³µêµ¬ í”Œë¡œìš° (Mainì—ì„œ HOLDING ì¤‘ ì¥ì• )               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [Mainì—ì„œ HOLDING ì¤‘] â†’ [ì¥ì•  ë°œìƒ!] â†’ [DR ë¦¬ì „ìœ¼ë¡œ Failover]     â”‚
â”‚       â”‚                    DR_RECOVERY_MODE=true                â”‚
â”‚       â”‚                    DR_RECOVERY_START_TIME=ì¥ì• ì‹œì        â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ HOLDING â”‚  (60ì´ˆ íƒ€ì´ë¨¸ ë§Œë£Œë¨, ì •ìƒì´ë©´ ì‚­ì œëì„ ê±´)            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                    â”‚
â”‚       â”‚ ì‚¬ìš©ìê°€ DR ë¦¬ì „ì—ì„œ confirm_reservation í˜¸ì¶œ             â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ DR_RECOVERED â”‚  â† ttl = í˜„ì¬ì‹œê°„ + 15ë¶„ (ë³µêµ¬ ìœ ì˜ˆê¸°ê°„)        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â”€â”€â”€ 15ë¶„ ê²½ê³¼ â”€â”€â”€â”€â†’ [ìë™ ì‚­ì œ] (ì¢Œì„ í•´ì œ)            â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ ì‚¬ìš©ìê°€ ê²°ì œ ì™„ë£Œ (confirm_reservation ì¬í˜¸ì¶œ)         â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚ CONFIRMED â”‚  â† ì •ìƒ ì˜ˆì•½ ì™„ë£Œ                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì½”ë“œ ì˜ˆì‹œ

```json
{
  "PK": "PERF#perf-kinky-1#2026-02-10#19:30",
  "SK": "SEAT#1ì¸µ-B-7-14",
  "status": "CONFIRMED",
  "holdingId": "550e8400-e29b-41d4-a716-446655440000",
  "reservationId": "660e8400-e29b-41d4-a716-446655440001",
  "userId": "visitor-abc123",
  "performanceId": "perf-kinky-1",
  "performanceTitle": "í‚¹í‚¤ë¶€ì¸ ",
  "venue": "ìƒ¤ë¡¯ë°ì”¨ì–´í„°",
  "posterUrl": "/posters/kinky.jpg",
  "date": "2026-02-10",
  "time": "19:30",
  "seatId": "1ì¸µ-B-7-14",
  "seatNumber": 14,
  "rowId": "7",
  "grade": "VIP",
  "price": 170000,
  "createdAt": "2025-12-28T05:10:00.000Z",
  "confirmedAt": "2025-12-28T05:10:30.000Z"
}
```

---

## ğŸ“¦ schedules í…Œì´ë¸”

### ëª©ì 
ê³µì—°ì˜ **íšŒì°¨(ìŠ¤ì¼€ì¤„) ì •ë³´**ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”.
- ë‚ ì§œ/ì‹œê°„ë³„ ê³µì—° íšŒì°¨ ê´€ë¦¬
- íšŒì°¨ë³„ ì”ì—¬ ì¢Œì„ ìˆ˜ (`availableSeats`) ê´€ë¦¬
- íšŒì°¨ë³„ ìºìŠ¤íŒ… ì •ë³´ (`casting`) - íŠ¹ì • íšŒì°¨ì— ì¶œì—°í•˜ëŠ” ë°°ìš°

### ì£¼ìš” ì‚¬ìš©ì²˜
- ì±—ë´‡: `get_performance_schedules` ë„êµ¬ - ë‚ ì§œ/ì‹œê°„ ì„ íƒ
- í”„ë¡ íŠ¸ì—”ë“œ: ê³µì—° ìƒì„¸ í˜ì´ì§€ ìº˜ë¦°ë”

### í‚¤ êµ¬ì¡°
- **Partition Key**: `scheduleId` (String)
- **GSI (Global Secondary Index)**: `performanceId-index` (PK: `performanceId`) - ê³µì—°ë³„ íšŒì°¨ ëª©ë¡ ì¡°íšŒìš©

### scheduleId í˜•ì‹

```
{performanceId}-{YYYY-MM-DD}-{HH:MM}

ì˜ˆì‹œ:
- perf-kinky-1-2026-04-24-19:30   (í‚¹í‚¤ë¶€ì¸  2026ë…„ 4ì›” 24ì¼ 19:30)
- perf-phantom-1-2026-03-05-14:30 (ì˜¤í˜ë¼ì˜ìœ ë ¹ 2026ë…„ 3ì›” 5ì¼ 14:30)
```

### ì‹¤ì œ DB í•„ë“œ (Scan ì¡°íšŒ ê²°ê³¼)

| í•„ë“œëª… | DynamoDB íƒ€ì… | ì‹¤ì œ ì˜ˆì‹œê°’ | ì„¤ëª… |
|-------|--------------|------------|------|
| `scheduleId` | S | `perf-kinky-1-2026-04-24-19:30` | íšŒì°¨ ê³ ìœ  ID **(PK)** |
| `performanceId` | S | `perf-kinky-1` | ê³µì—° ID (FK â†’ performances) |
| `date` | S | `2026-04-24` | ê³µì—° ë‚ ì§œ (YYYY-MM-DD) |
| `time` | S | `19:30` | ê³µì—° ì‹œê°„ (HH:MM) |
| `datetime` | S | `2026-04-24T19:30` | ë‚ ì§œ+ì‹œê°„ ê²°í•© (ì¡°íšŒ í¸ì˜) |
| `dayOfWeek` | S | `ê¸ˆ` | ìš”ì¼ (ì›”/í™”/ìˆ˜/ëª©/ê¸ˆ/í† /ì¼) |
| `totalSeats` | N | `1210` | ì´ ì¢Œì„ ìˆ˜ |
| `availableSeats` | N | `1210` | ì”ì—¬ ì¢Œì„ ìˆ˜ |
| `status` | S | `AVAILABLE` | ìƒíƒœ (AVAILABLE/SOLDOUT/CANCELLED) |
| `casting` | M (Map) | (ì•„ë˜ ì°¸ì¡°) | **íšŒì°¨ë³„ ìºìŠ¤íŒ… ì •ë³´** |
| `createdAt` | S | `2025-12-25T17:34:24.780143Z` | ìƒì„±ì¼ì‹œ |

### casting í•„ë“œ êµ¬ì¡° (DB ì‹¤ì œ ë°ì´í„°)

> âš ï¸ **í•„ë“œëª…**: `casting` (Map íƒ€ì…) - `cast` ì•„ë‹˜!  
> performances í…Œì´ë¸”ì˜ `cast`ì™€ êµ¬ì¡°ëŠ” ë™ì¼í•˜ë‚˜ í•„ë“œëª…ì´ ë‹¤ë¦„

```json
{
  "casting": {
    "charlie": ["ê¹€í˜¸ì˜", "ì‹ ì¬ë²”", "ì´ì¬í™˜"],
    "lola": ["ì„œê²½ìˆ˜", "ê°•í™ì„", "ë°±í˜•í›ˆ"],
    "lauren": ["í•œì¬ì•„", "í—ˆìœ¤ìŠ¬"],
    "don": ["ì‹¬ì¬í˜„", "ì‹ ìŠ¹í™˜", "ê¹€ë™í˜„"],
    "nicola": ["ì´ë£¨ì›", "ìœ ì£¼ì—°"]
  }
}
```

### ë ˆì½”ë“œ ì˜ˆì‹œ

```json
{
  "scheduleId": "perf-kinky-1-2026-04-24-19:30",
  "performanceId": "perf-kinky-1",
  "date": "2026-04-24",
  "time": "19:30",
  "datetime": "2026-04-24T19:30",
  "dayOfWeek": "ê¸ˆ",
  "totalSeats": 1210,
  "availableSeats": 1210,
  "status": "AVAILABLE",
  "casting": { ... },
  "createdAt": "2025-12-25T17:34:24.780143Z"
}
```

---

## ğŸ“¦ venues í…Œì´ë¸”

### ëª©ì 
**ê³µì—°ì¥ ë§ˆìŠ¤í„° ë°ì´í„°**ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”.
- ê³µì—°ì¥ ì´ë¦„, ì£¼ì†Œ, ìœ í˜• ë“± ê¸°ë³¸ ì •ë³´
- **ì¢Œì„ ë°°ì¹˜ êµ¬ì¡°** (`sections`) - êµ¬ì—­/ì—´/ì¢Œì„ ë°°ì¹˜ë„ ì •ì˜
- ì´ ì¢Œì„ ìˆ˜, ì¸µë³„ ì¢Œì„ ìˆ˜ ë“± í†µê³„ ì •ë³´

### ì£¼ìš” ì‚¬ìš©ì²˜
- ì±—ë´‡: `get_venue_info` ë„êµ¬ - ê³µì—°ì¥ ì •ë³´ ì¡°íšŒ
- í”„ë¡ íŠ¸ì—”ë“œ: ì¢Œì„ ë°°ì¹˜ë„ ë Œë”ë§ (`SeatMap` ì»´í¬ë„ŒíŠ¸)

### í‚¤ êµ¬ì¡°
- **Partition Key**: `venueId` (String)

### ì‹¤ì œ DB í•„ë“œ (Scan ì¡°íšŒ ê²°ê³¼)

| í•„ë“œëª… | DynamoDB íƒ€ì… | ì‹¤ì œ ì˜ˆì‹œê°’ | ì„¤ëª… |
|-------|--------------|------------|------|
| `venueId` | S | `charlotte-theater` | ê³µì—°ì¥ ê³ ìœ  ID **(PK)** |
| `name` | S | `ìƒ¤ë¡¯ë°ì”¨ì–´í„°` | ê³µì—°ì¥ ì´ë¦„ |
| `address` | S | `ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 240` | ì£¼ì†Œ |
| `venueType` | S | `theater` | ê³µì—°ì¥ ìœ í˜• |
| `totalSeats` | N | `1385` | ì´ ì¢Œì„ ìˆ˜ |
| `floor1Seats` | N | `960` | 1ì¸µ ì¢Œì„ ìˆ˜ |
| `floor2Seats` | N | `425` | 2ì¸µ ì¢Œì„ ìˆ˜ |
| `sections` | L (List) | (ì•„ë˜ ì°¸ì¡°) | êµ¬ì—­ë³„ ì¢Œì„ ë°°ì¹˜ |

### sections í•„ë“œ êµ¬ì¡° (DB ì‹¤ì œ ë°ì´í„°)

```json
{
  "sections": [
    {
      "sectionId": "A",
      "floor": "1ì¸µ",
      "rows": [
        {
          "rowId": "13",
          "grade": "A",
          "length": 12,
          "seats": [
            {"seatId": "1ì¸µ-A-13-1", "seatNumber": 1, "status": "available"},
            {"seatId": "1ì¸µ-A-13-2", "seatNumber": 2, "status": "available"}
          ]
        }
      ]
    },
    {
      "sectionId": "B",
      "floor": "1ì¸µ",
      "rows": [
        {
          "rowId": "OP",
          "grade": "OP",
          "length": 12,
          "seats": [...]
        },
        {
          "rowId": "1",
          "grade": "VIP",
          "length": 24,
          "seats": [...]
        }
      ]
    }
  ]
}
```

---

## ğŸ”— í…Œì´ë¸” ê°„ ê´€ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   performances    â”‚         â”‚      venues       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ performanceId(PK) â”‚         â”‚   venueId (PK)    â”‚
â”‚     title         â”‚         â”‚     name          â”‚
â”‚   venueId â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   address         â”‚
â”‚  seatGrades(SSOT) â”‚         â”‚   sections        â”‚
â”‚     cast          â”‚         â”‚   totalSeats      â”‚
â”‚  hasOPSeats       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N (performanceIdë¡œ ì—°ê²°)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    schedules      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ scheduleId (PK)   â”‚
â”‚ performanceId(FK) â”‚
â”‚    date, time     â”‚
â”‚  availableSeats   â”‚
â”‚    casting        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (date+time â†’ reservations.PKì˜ ì¼ë¶€)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              reservations                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: PERF#{performanceId}#{date}#{time}    â”‚
â”‚ SK: SEAT#{seatId}                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ status, userId, holdingId, reservationId  â”‚
â”‚ performanceTitle, venue, posterUrl â—€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ ë¹„ì •ê·œí™” (CONFIRMED ì‹œ)
â”‚ holdExpiresAt(TTL), ttl(TTL)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ í‚¤ ìƒì„± í•¨ìˆ˜

### PK (Partition Key) ìƒì„±

```typescript
/**
 * reservations í…Œì´ë¸”ì˜ Partition Key ìƒì„±
 * ë™ì¼ íšŒì°¨ì˜ ëª¨ë“  ì¢Œì„ì„ í•œ ë²ˆì— Queryí•˜ê¸° ìœ„í•œ ì„¤ê³„
 */
function createPK(performanceId: string, date: string, time: string): string {
    return `PERF#${performanceId}#${date}#${time}`;
}

// ì˜ˆì‹œ
createPK("perf-kinky-1", "2026-02-10", "19:30")
// ê²°ê³¼: "PERF#perf-kinky-1#2026-02-10#19:30"
```

### SK (Sort Key) ìƒì„±

```typescript
/**
 * reservations í…Œì´ë¸”ì˜ Sort Key ìƒì„±
 */
function createSK(seatId: string): string {
    return `SEAT#${seatId}`;
}

// ì˜ˆì‹œ
createSK("1ì¸µ-B-7-14")
// ê²°ê³¼: "SEAT#1ì¸µ-B-7-14"
```

### seatId í˜•ì‹

```
{floor}-{section}-{row}-{seatNumber}

ì˜ˆì‹œ:
- 1ì¸µ-B-7-14  â†’ 1ì¸µ Bêµ¬ì—­ 7ì—´ 14ë²ˆ
- 1ì¸µ-B-OP-5 â†’ 1ì¸µ Bêµ¬ì—­ OPì—´ 5ë²ˆ (ì˜¤ì¼€ìŠ¤íŠ¸ë¼ í”¼íŠ¸ì„)
- 2ì¸µ-A-3-8  â†’ 2ì¸µ Aêµ¬ì—­ 3ì—´ 8ë²ˆ
```

---

## â° TTL (Time To Live) ìƒì„¸

DynamoDB TTL ê¸°ëŠ¥ì„ í™œìš©í•œ ìë™ ë ˆì½”ë“œ ì‚­ì œ.

### TTL í•„ë“œ ë° ì„¤ì •

| ìƒíƒœ | TTL í•„ë“œ | ê°’ í˜•ì‹ | ë§Œë£Œ ì‹œê°„ | ìš©ë„ |
|-----|---------|--------|----------|------|
| HOLDING | `holdExpiresAt` | Unix timestamp (ì´ˆ) | **60ì´ˆ** | ì¢Œì„ ì„ ì  ìë™ í•´ì œ |
### 1. TTL ë™ì‘ êµ¬ì¡° (App vs DB)

DynamoDBì˜ TTL(Time To Live) ê¸°ëŠ¥ì€ **ë°ì´í„° ì‚­ì œ ì‹œì ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤** (ë§Œë£Œ í›„ ì‹¤ì œ ì‚­ì œê¹Œì§€ ìˆ˜ë¶„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŒ). ë”°ë¼ì„œ ì¦‰ê°ì ì¸ ë§Œë£Œ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê¸°ëŠ¥(ì¢Œì„ ì„ ì  ë“±)ì€ **Application ë ˆë²¨ì˜ ë¡œì§**ì´ ì£¼ë„í•˜ê³ , DynamoDB TTLì€ **ë°ì´í„° ì •ë¦¬(Garbage Collection)** ìš©ë„ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

| êµ¬ë¶„ | Application Level (ì¦‰ì‹œ ë§Œë£Œ) | DynamoDB Native TTL (ì§€ì—° ì‚­ì œ) |
|-----|------------------------------|--------------------------------|
| **ê¸°ì¤€ í•„ë“œ** | `expiresAt` (ISO 8601 ë¬¸ìì—´) | `holdExpiresAt` ë˜ëŠ” `ttl` (Unix Timestamp) |
| **ì‘ë™ ë°©ì‹** | ì¡°íšŒ ì‹œì (`getItem`)ì— í˜„ì¬ ì‹œê°„ê³¼ ë¹„êµí•˜ì—¬ ë§Œë£Œ ì—¬ë¶€ íŒë‹¨ | ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ìŠ¤ìº”í•˜ì—¬ ë§Œë£Œëœ í•­ëª© ì‚­ì œ |
| **ì¥ì ** | ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì •í™•í•œ ë§Œë£Œ ì²˜ë¦¬ ê°€ëŠ¥ | ë³„ë„ ì‚­ì œ ë¡œì§ ì—†ì´ ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ì ˆê° |
| **ì ìš© ëŒ€ìƒ** | ì¢Œì„ ì„ ì (Holding) ìœ íš¨ì„± ê²€ì‚¬ | ë§Œë£Œëœ ì„ ì  ë°ì´í„° ì‚­ì œ, ì·¨ì†Œëœ ì˜ˆì•½ ì´ë ¥ ì‚­ì œ |

### 2. ìƒíƒœë³„ TTL ì„¤ì • í˜„í™©

| ìƒíƒœ | í•„ë“œëª… | ë§Œë£Œ ì‹œê°„ | ì²˜ë¦¬ ë°©ì‹ |
|-----|-------|----------|----------|
| **HOLDING** | `expiresAt` | 60ì´ˆ | **App ì²˜ë¦¬**: `getHolding` í˜¸ì¶œ ì‹œ ë§Œë£Œëìœ¼ë©´ `false` ë°˜í™˜ |
| | `holdExpiresAt`| 60ì´ˆ | **DB ì²˜ë¦¬**: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìë™ ì‚­ì œ (ì²­ì†Œ) |
| **CANCELLED** | `ttl` | 7ì¼ | **DB ì²˜ë¦¬**: 7ì¼ í›„ ìë™ ì‚­ì œ (ì´ë ¥ ë³´ê´€ ê¸°ê°„ ì¢…ë£Œ) |
| **DR_RECOVERED** | `expiresAt` | 15ë¶„ | **App ì²˜ë¦¬**: ë³µêµ¬ ìœ ì˜ˆ ì‹œê°„ ì²´í¬ |

### 3. DB ìë™ ì‚­ì œ ì—¬ë¶€ ìš”ì•½

| ìƒíƒœ | DB ì²˜ë¦¬ ë°©ì‹ |
|-----|-------------|
| **HOLDING** | âœ… **60ì´ˆ í›„ ìë™ ì‚­ì œ** |
| **CANCELLED** | âœ… **7ì¼ í›„ ìë™ ì‚­ì œ** |
| **DR_RECOVERED** | âœ… **15ë¶„ í›„ ìë™ ì‚­ì œ** |
| **CONFIRMED** | âŒ **ì‚­ì œ ì•ˆ í•¨** (ì˜êµ¬ ë³´ì¡´) |
| **DR_RESERVED** | âŒ **ì‚­ì œ ì•ˆ í•¨** (ì˜êµ¬ ë³´ì¡´) |

### 4. TTL ê³„ì‚° ì˜ˆì‹œ

```typescript
// HOLDING (60ì´ˆ)
const now = new Date();
const holdExpiresAt = Math.floor(now.getTime() / 1000) + 60;

// CANCELLED (7ì¼)
const retentionDays = parseInt(process.env.CANCELLED_RETENTION_DAYS || '7');
const ttl = Math.floor(now.getTime() / 1000) + (retentionDays * 86400);

// DR_RECOVERED (15ë¶„)
const gracePeriodMinutes = parseInt(process.env.DR_GRACE_PERIOD_MINUTES || '15');
const ttl = Math.floor(now.getTime() / 1000) + (gracePeriodMinutes * 60);
```

### TTL ë™ì‘ ë°©ì‹

1. DynamoDBê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ TTL ë§Œë£Œ ë ˆì½”ë“œ ìŠ¤ìº”
2. ë§Œë£Œëœ ë ˆì½”ë“œ ìë™ ì‚­ì œ (ìˆ˜ì´ˆ ~ ìˆ˜ë¶„ ë‚´)
3. ì‚­ì œ ì§€ì—° ê°€ëŠ¥ì„± ìˆìŒ â†’ ì½”ë“œì—ì„œ `expiresAt` í•„ë“œë¡œ ì¶”ê°€ ê²€ì¦ í•„ìš”

```typescript
// ì½”ë“œì—ì„œ ë§Œë£Œ ì²´í¬ ì˜ˆì‹œ (holding-manager.ts)
const expiresAt = item.expiresAt;
if (expiresAt && expiresAt < now) {
    // ë§Œë£Œë¨ - availableë¡œ ì²˜ë¦¬
    statusMap[seatId] = 'available';
}
```

---

## âš™ï¸ í™˜ê²½ë³€ìˆ˜

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DynamoDB í…Œì´ë¸”ëª…
# ì½”ë“œì—ì„œëŠ” process.env.DYNAMODB_XXXX_TABLE || "ê¸°ë³¸ê°’" í˜•íƒœë¡œ ë¡œë“œë©ë‹ˆë‹¤.
# DR í™˜ê²½ ë“±ì—ì„œ í…Œì´ë¸”ëª…ì„ ë³€ê²½í•´ì•¼ í•  ê²½ìš° ì•„ë˜ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DYNAMODB_PERFORMANCES_TABLE=KDT-Msp4-PLDR-performances
DYNAMODB_RESERVATIONS_TABLE=KDT-Msp4-PLDR-reservations
DYNAMODB_SCHEDULES_TABLE=KDT-Msp4-PLDR-schedules
DYNAMODB_VENUES_TABLE=KDT-Msp4-PLDR-venues

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AWS ì„¤ì •
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AWS_REGION=ap-northeast-2

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# TTL ì„¤ì •
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# HOLDING: 60ì´ˆ (ì½”ë“œ í•˜ë“œì½”ë”©, holding-manager.ts Line 77)
# CANCELLED: ì•„ë˜ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • (ê¸°ë³¸ê°’ 7ì¼)
CANCELLED_RETENTION_DAYS=7

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ìºì‹œ ì„¤ì • (performance-service.ts)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CACHE_TTL_MS=604800000   # 7ì¼ = 604,800,000ms

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Disaster Recovery (ì¥ì•  ë³µêµ¬) ì„¤ì •
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DR_RECOVERY_MODE=false              # ì¥ì•  ë³µêµ¬ ëª¨ë“œ í™œì„±í™” ì—¬ë¶€
DR_RECOVERY_START_TIME=             # ë³µêµ¬ ì‹œì‘ ì‹œê°„ (ISO 8601)
DR_GRACE_PERIOD_MINUTES=15          # ë³µêµ¬ ìœ ì˜ˆ ê¸°ê°„ (ê¸°ë³¸ 15ë¶„)
```

---

## ğŸ“Š ë°ì´í„° íƒ€ì… ë²”ë¡€

| DynamoDB íƒ€ì… | ì•½ì–´ | TypeScript íƒ€ì… | ì„¤ëª… |
|--------------|-----|----------------|------|
| String | S | string | ë¬¸ìì—´ |
| Number | N | number | ìˆ«ì |
| Boolean | BOOL | boolean | true/false |
| List | L | any[] | ë°°ì—´ `[...]` |
| Map | M | Record<string, any> | ê°ì²´ `{...}` |

---

## âš ï¸ ì½”ë“œì™€ DB í•„ë“œëª… ì°¨ì´

| í…Œì´ë¸” | DB í•„ë“œëª… | ì½”ë“œ ë³€ìˆ˜ëª… | ë¹„ê³  |
|-------|----------|------------|------|
| schedules | `casting` | `casting` ë˜ëŠ” `cast` | ì½”ë“œì—ì„œ fallback ì²˜ë¦¬ (`casting || cast`) |
| performances | `cast` | `cast` | ì¼ì¹˜ |

---

## ğŸ“ ì£¼ìš” ì¿¼ë¦¬ íŒ¨í„´

### 1. íŠ¹ì • íšŒì°¨ì˜ ëª¨ë“  ì¢Œì„ ìƒíƒœ ì¡°íšŒ

```typescript
// PKë¡œ Query â†’ í•´ë‹¹ íšŒì°¨ì˜ ëª¨ë“  ì¢Œì„
const result = await dynamoDb.send(new QueryCommand({
    TableName: RESERVATIONS_TABLE,
    KeyConditionExpression: "PK = :pk",
    ExpressionAttributeValues: {
        ":pk": "PERF#perf-kinky-1#2026-02-10#19:30"
    }
}));
```

### 2. ì‚¬ìš©ìë³„ ì˜ˆì•½ ì¡°íšŒ

```typescript
// GSI ì‚¬ìš© (userId-index)
const result = await dynamoDb.send(new QueryCommand({
    TableName: RESERVATIONS_TABLE,
    IndexName: 'userId-index',
    KeyConditionExpression: "userId = :uid",
    FilterExpression: "#s = :c1 OR #s = :c2 OR #s = :c3 OR #s = :c4",
    ExpressionAttributeNames: { "#s": "status" },
    ExpressionAttributeValues: {
        ":uid": "visitor-abc123",
        ":c1": "CONFIRMED",
        ":c2": "CANCELLED",
        ":c3": "DR_RECOVERED",
        ":c4": "DR_RESERVED"
    }
}));
```

### 3. ê³µì—°ë³„ ìŠ¤ì¼€ì¤„ ì¡°íšŒ

```typescript
// GSI ì‚¬ìš© (performanceId-index)
const result = await dynamoDb.send(new QueryCommand({
    TableName: SCHEDULES_TABLE,
    IndexName: "performanceId-index",
    KeyConditionExpression: "performanceId = :pid",
    ExpressionAttributeValues: {
        ":pid": "perf-kinky-1"
    }
}));
```

---

## ğŸ”§ ê°œì„  ì™„ë£Œ ì‚¬í•­

1. âœ… **scheduleId í˜•ì‹ í†µì¼**: ì½”ë“œ ì£¼ì„ì„ DB ì‹¤ì œ í˜•ì‹(`perf-kinky-1-2026-02-10-19:30`)ìœ¼ë¡œ ìˆ˜ì • ì™„ë£Œ

---

## ğŸ’¾ ì¸ë©”ëª¨ë¦¬ ìºì‹± ì „ëµ

### ê°œë…: ì¸ë©”ëª¨ë¦¬ ìºì‹±ì´ë€?

**ì¸ë©”ëª¨ë¦¬ ìºì‹±(In-Memory Caching)**ì€ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë¥¼ ë””ìŠ¤í¬(DB)ê°€ ì•„ë‹Œ **ì„œë²„ì˜ ë©”ëª¨ë¦¬(RAM)**ì— ì„ì‹œ ì €ì¥í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.
- **ëª©ì **: DB ì¡°íšŒ íšŸìˆ˜ë¥¼ ì¤„ì—¬ **ë¹„ìš©ì„ ì ˆê°**í•˜ê³ , **ì‘ë‹µ ì†ë„**ë¥¼ íšê¸°ì ìœ¼ë¡œ ê°œì„ 
- **íŠ¹ì§•**: ì„œë²„ê°€ ì¬ì‹œì‘ë˜ë©´ ë©”ëª¨ë¦¬ê°€ ë¹„ì›Œì§€ë¯€ë¡œ ìºì‹œ ë°ì´í„°ë„ ì‚¬ë¼ì§ (íœ˜ë°œì„±) -> ë°ì´í„°ì˜ ì˜êµ¬ ì €ì¥ì´ ì•„ë‹Œ **ì¡°íšŒ ìµœì í™”** ìš©ë„

### ì„¤ê³„ ì›ì¹™

**ì›ì¹™ 1: ì¸ë©”ëª¨ë¦¬ ìºì‹±ìœ¼ë¡œ DB ë¹„ìš© ì ˆê°**

| ëŒ€ì•ˆ | ì¥ì  | ë‹¨ì  | ì„ íƒ |
|-----|-----|-----|------|
| **ì¸ë©”ëª¨ë¦¬ ìºì‹œ** | êµ¬í˜„ ë‹¨ìˆœ, ë¹„ìš© 0ì›, ë¹ ë¦„ | ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™” | âœ… ì±„íƒ |
| ElastiCache (Redis) | ë¶„ì‚° ìºì‹œ | ì¶”ê°€ ë¹„ìš©, ê´€ë¦¬ ë³µì¡ | âŒ |
| DynamoDB DAX | ì™„ì „ê´€ë¦¬í˜• | ë¹„ìš© ë†’ìŒ (~$50/ì›”) | âŒ |

**ì›ì¹™ 2: ìºì‹œ ëŒ€ìƒ ëª…í™•íˆ ë¶„ë¦¬**

```
ì •ì  ë°ì´í„° (ìºì‹± O):
â”œâ”€â”€ ê³µì—° ì •ë³´ â†’ ë³€ê²½ ì‹œ ì‚¬ì „ ê³µì§€, ì„œë²„ ì¬ì‹œì‘ìœ¼ë¡œ ê°±ì‹ 
â”œâ”€â”€ ì¢Œì„ ë“±ê¸‰/ê°€ê²© â†’ ê³µì—° ì‹œì‘ ì „ í™•ì •, ë³€ê²½ ê±°ì˜ ì—†ìŒ
â””â”€â”€ ì¼ì • ì •ë³´ â†’ í™•ì • í›„ ë³€ê²½ ë“œë¬¾

ì‹¤ì‹œê°„ ë°ì´í„° (ìºì‹± X):
â”œâ”€â”€ ì˜ˆì•½ ìƒíƒœ â†’ ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ë™ì‹œ ì˜ˆì•½ ì‹œ ì •í•©ì„± í•„ìˆ˜
â”œâ”€â”€ ì¢Œì„ ì„ ì  â†’ 60ì´ˆ íƒ€ì´ë¨¸, ì‹¤ì‹œê°„ ìƒíƒœ ë°˜ì˜ í•„ìˆ˜
â””â”€â”€ ì”ì—¬ ì¢Œì„ â†’ ì´ˆ ë‹¨ìœ„ë¡œ ë³€ê²½ ê°€ëŠ¥
```

### ìºì‹± ì ìš© í•¨ìˆ˜

| í•¨ìˆ˜ | ìºì‹œ í‚¤ íŒ¨í„´ | ìºì‹œ TTL | ë¹„ê³  |
|-----|------------|---------|------|
| `getPerformance()` | `perf:{performanceId}` | 7ì¼ | seatGrades, gradeMapping, hasOPSeats í¬í•¨ |
| `getAllPerformances()` | `perfs:all` | 7ì¼ | ì „ì²´ ê³µì—° ëª©ë¡ |
| `getPerformanceSchedules()` | `schedules:{performanceId}` | 7ì¼ | ì¼ì • ëª©ë¡ |
| `getSchedule()` | `schedule:{scheduleId}` | 7ì¼ | ê°œë³„ ì¼ì • |
| `getVenue()` | `venue:{venueId}` | 7ì¼ | ê³µì—°ì¥ ì •ë³´ + sections (SSOT) |

### ìºì‹± ë¯¸ì ìš© ëŒ€ìƒ (ì‹¤ì‹œê°„ í•„ìˆ˜)

| í•¨ìˆ˜ | ì´ìœ  |
|-----|------|
| `getReservations()` | ì˜ˆì•½ ìƒíƒœ ì‹¤ì‹œê°„ ë°˜ì˜ |
| `getUserReservations()` | ì‚¬ìš©ìë³„ ì˜ˆì•½ ì‹¤ì‹œê°„ ì¡°íšŒ |
| `getHoldings()` | 60ì´ˆ ì„ ì  íƒ€ì´ë¨¸ |
| `getAvailableSeats()` | ì”ì—¬ ì¢Œì„ ì‹¤ì‹œê°„ ê³„ì‚° |
| ëª¨ë“  ì“°ê¸° ì‘ì—… | DB ì§ì ‘ ë°˜ì˜ í•„ìˆ˜ |

### ìºì‹œ TTL ì„¤ì •

```typescript
// performance-service.ts
private defaultTTL = parseInt(process.env.CACHE_TTL_MS || '604800000'); // 7ì¼ (ë°€ë¦¬ì´ˆ)
```

> ğŸ“ **ì„¤ê³„ ì˜ë„**: ì‹¤ì œ ìºì‹œ ìˆ˜ëª…ì€ ë°°í¬/ì¬ì‹œì‘ ì£¼ê¸°(1~3ì¼)ì— ë§ì¶° ì´ˆê¸°í™”ë¨ â†’ ë³„ë„ ìºì‹œ ë¬´íš¨í™” API ë¶ˆí•„ìš”

### ì˜ˆìƒ íš¨ê³¼

| í•­ëª© | Before | After |
|-----|--------|-------|
| ëŒ€í™”ë‹¹ DB ì¡°íšŒ | 5~10íšŒ | ì²« ëŒ€í™”ë§Œ 3~4íšŒ, ì´í›„ 0íšŒ |
| DynamoDB ì½ê¸° ë¹„ìš© | 100% | ~10~20% |
| ì‘ë‹µ ì†ë„ | DB ì§€ì—° í¬í•¨ | ìºì‹œ HIT ì‹œ ì¦‰ì‹œ |

---

## ğŸ”„ DR ê´€ë ¨ ìƒíƒœ ìƒì„¸ (DR_RESERVED / DR_RECOVERED)

### ì˜ˆì•½ ìƒíƒœ ì „ì²´ ëª©ë¡

| ìƒíƒœ | ì„¤ëª… | UI í‘œì‹œ | TTL |
|-----|------|---------|-----|
| `HOLDING` | ì¢Œì„ ì„ ì  ì¤‘ | "ì„ ì  ì¤‘ - 60ì´ˆ ë‚´ ê²°ì œ í•„ìš”" | 60ì´ˆ |
| `CONFIRMED` | **Main(ì„œìš¸)** ë¦¬ì „ ì˜ˆì•½ í™•ì • | "âœ… ì˜ˆì•½ ì™„ë£Œ" | ì—†ìŒ |
| `DR_RESERVED` | **DR(ë„ì¿„)** ë¦¬ì „ì—ì„œ ìƒˆë¡œ ì˜ˆì•½í•œ ê±´ | "âœ… ì˜ˆì•½ ì™„ë£Œ (DR)" | ì—†ìŒ |
| `DR_RECOVERED` | Mainì—ì„œ HOLDING ì¤‘ ì¥ì•  â†’ DRì—ì„œ ë³µêµ¬ | "âš ï¸ ë³µêµ¬ë¨ - ê²°ì œ ì§„í–‰ í•„ìš”" | 15ë¶„ |
| `CANCELLED` | ì·¨ì†Œë¨ (Soft Delete) | ì¡°íšŒ ê²°ê³¼ì—ì„œ ì œì™¸ | 7ì¼ |

### DR_RESERVED vs DR_RECOVERED ì°¨ì´

| ìƒíƒœ | ì‹œë‚˜ë¦¬ì˜¤ | ê²°ì œ ì™„ë£Œ | TTL | ì‚¬ìš©ì ì•¡ì…˜ |
|-----|---------|----------|-----|------------|
| `DR_RESERVED` | DR ë¦¬ì „ì—ì„œ **ìƒˆë¡œ ì˜ˆì•½**í•œ ê±´ | âœ… ì™„ë£Œ | ì—†ìŒ | ì—†ìŒ (ì˜ˆì•½ í™•ì¸ë§Œ) |
| `DR_RECOVERED` | Mainì—ì„œ **HOLDING ì¤‘ ì¥ì• ** â†’ DRì—ì„œ ë³µêµ¬ | âŒ ëŒ€ê¸° | 15ë¶„ | [ì˜ˆì•½ ê³„ì†í•˜ê¸°] ë˜ëŠ” [ì·¨ì†Œí•˜ê¸°] |

### DR_RECOVEREDê°€ í•„ìš”í•œ ì´ìœ 

```
ì •ìƒ íë¦„ (Main ë¦¬ì „):
  HOLDING (60ì´ˆ) â†’ ê²°ì œ â†’ CONFIRMED

DR ë¦¬ì „ ì‹ ê·œ ì˜ˆì•½:
  HOLDING (60ì´ˆ) â†’ ê²°ì œ â†’ DR_RESERVED

ì¥ì•  ë³µêµ¬ (Mainì—ì„œ HOLDING ì¤‘ ì¥ì• ):
  [Main] HOLDING ì¤‘ â†’ ì¥ì•  ë°œìƒ! â†’ [DR ë¦¬ì „ìœ¼ë¡œ Failover]
                          â†“
              60ì´ˆ íƒ€ì´ë¨¸ ë§Œë£Œë¨ (ì •ìƒì´ë©´ ì‚­ì œ)
              í•˜ì§€ë§Œ ì¥ì•  ìƒí™©ì´ë¯€ë¡œ ì‚¬ìš©ì ë³´í˜¸ í•„ìš”
                          â†“
  [DR] ì‚¬ìš©ìê°€ "ì˜ˆì•½ ê³„ì†í•˜ê¸°" í´ë¦­
                          â†“
              HOLDING â†’ DR_RECOVERED (15ë¶„ ìœ ì˜ˆ)
              "15ë¶„ ì•ˆì— ê²°ì œë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”"
                          â†“
              ê²°ì œ ì™„ë£Œ â†’ CONFIRMED
```

### í™˜ê²½ë³€ìˆ˜ ì„¤ì • (DR ëª¨ë“œ)

| í™˜ê²½ë³€ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œê°’ |
|---------|------|-------|
| `DR_RECOVERY_MODE` | DR ë³µêµ¬ ëª¨ë“œ í™œì„±í™” | `true` |
| `DR_RECOVERY_START_TIME` | ì¥ì•  ë°œìƒ ì‹œì  (ISO 8601) | `2025-12-29T13:00:00Z` |
| `DR_GRACE_PERIOD_MINUTES` | ë³µêµ¬ ìœ ì˜ˆ ê¸°ê°„ (ë¶„) | `15` |

> ğŸ“ **êµ¬ë¶„ ë¡œì§**: `holdingCreatedAt < DR_RECOVERY_START_TIME`ì´ë©´ Mainì—ì„œ ì¥ì•  ì „ ì„ ì  â†’ DR_RECOVERED

---

## ğŸ’° GSI (Global Secondary Index) ì¸í”„ë¼ ì„¤ì •

### GSI í•„ìš” ì—¬ë¶€ ë¶„ì„

| í…Œì´ë¸” | í˜„ì¬ ì¿¼ë¦¬ ë°©ì‹ | GSI í•„ìš”? |
|--------|---------------|-----------| 
| `reservations` | Query + GSI | âœ… **3ê°œ GSI ì¶”ê°€ ì™„ë£Œ** |
| `performances` | PK Query (performanceId) | âŒ ë¶ˆí•„ìš” |
| `schedules` | GSI ì´ë¯¸ ì¡´ì¬ (`performanceId-index`) | âŒ ë¶ˆí•„ìš” |
| `venues` | PK Query (venueId) | âŒ ë¶ˆí•„ìš” |

---

### âœ… reservations í…Œì´ë¸” GSI í˜„í™© (2025-12-28)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 reservations í…Œì´ë¸” í‚¤ êµ¬ì¡°                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PK (Partition Key): PERF#{performanceId}#{date}#{time}     â”‚
â”‚  SK (Sort Key):      SEAT#{seatId}                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  holdingId:       ì¼ë°˜ í•„ë“œ (UUID) â† PK ì•„ë‹˜!               â”‚
â”‚  reservationId:   ì¼ë°˜ í•„ë“œ (UUID) â† PK ì•„ë‹˜!               â”‚
â”‚  userId:          ì¼ë°˜ í•„ë“œ        â† GSIë¡œ ì¡°íšŒ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬**: `holdingId`, `reservationId`, `userId` ëª¨ë‘ **PK/SKê°€ ì•„ë‹Œ ì¼ë°˜ í•„ë“œ**ì´ë¯€ë¡œ GSI ì—†ì´ëŠ” **Scanë§Œ ê°€ëŠ¥**

---

### ğŸ“Œ GSI 1: `userId-index`

```
í…Œì´ë¸”: KDT-Msp4-PLDR-reservations
â”œâ”€â”€ ì¸ë±ìŠ¤ ì´ë¦„: userId-index
â”œâ”€â”€ íŒŒí‹°ì…˜ í‚¤: userId (String)
â”œâ”€â”€ ì •ë ¬ í‚¤: (ì—†ìŒ)
â”œâ”€â”€ ì†ì„± í”„ë¡œì ì…˜: All
â””â”€â”€ ìƒíƒœ: Active âœ…
```

#### ì™œ í•„ìš”í•œê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               userId-index ì‚¬ìš© ì¼€ì´ìŠ¤                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“± ì±—ë´‡: "ë‚´ ì˜ˆì•½ ë³´ì—¬ì¤˜"        â†’ userIdë¡œ ì¡°íšŒ            â”‚
â”‚  ğŸ–¥ï¸ ë§ˆì´í˜ì´ì§€ ì ‘ì†í•  ë•Œë§ˆë‹¤      â†’ userIdë¡œ ì¡°íšŒ            â”‚
â”‚  ğŸ“§ ì•Œë¦¼ ë°œì†¡ ì‹œ (ê³µì—° ì „ë‚ )      â†’ ì „ì²´ ì˜ˆì•½ ì¡°íšŒ           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëŒ€ìƒ í•¨ìˆ˜**: `getUserReservations()`

---

### ğŸ“Œ GSI 2: `holdingId-index`

```
í…Œì´ë¸”: KDT-Msp4-PLDR-reservations
â”œâ”€â”€ ì¸ë±ìŠ¤ ì´ë¦„: holdingId-index
â”œâ”€â”€ íŒŒí‹°ì…˜ í‚¤: holdingId (String)
â”œâ”€â”€ ì •ë ¬ í‚¤: (ì—†ìŒ)
â”œâ”€â”€ ì†ì„± í”„ë¡œì ì…˜: All
â””â”€â”€ ìƒíƒœ: Active âœ…
```

#### ì™œ í•„ìš”í•œê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               holdingId-index ì‚¬ìš© ì¼€ì´ìŠ¤                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ”„ ì„ ì  í™•ì¸ (60ì´ˆ íƒ€ì´ë¨¸)       â†’ holdingIdë¡œ ì¡°íšŒ         â”‚
â”‚  âœ… ì˜ˆì•½ í™•ì • ì²˜ë¦¬                â†’ holdingIdë¡œ ì¡°íšŒ         â”‚
â”‚  âŒ ì„ ì  ì·¨ì†Œ ì²˜ë¦¬                â†’ holdingIdë¡œ ì¡°íšŒ         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëŒ€ìƒ í•¨ìˆ˜**: `getHolding()`, `releaseHolding()`, `confirmReservation()`

---

### ğŸ“Œ GSI 3: `reservationId-index`

```
í…Œì´ë¸”: KDT-Msp4-PLDR-reservations
â”œâ”€â”€ ì¸ë±ìŠ¤ ì´ë¦„: reservationId-index
â”œâ”€â”€ íŒŒí‹°ì…˜ í‚¤: reservationId (String)
â”œâ”€â”€ ì •ë ¬ í‚¤: (ì—†ìŒ)
â”œâ”€â”€ ì†ì„± í”„ë¡œì ì…˜: All
â””â”€â”€ ìƒíƒœ: Active âœ…
```

#### ì™œ í•„ìš”í•œê°€?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               reservationId-index ì‚¬ìš© ì¼€ì´ìŠ¤                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âŒ ì˜ˆì•½ ì·¨ì†Œ ì²˜ë¦¬                â†’ reservationIdë¡œ ì¡°íšŒ     â”‚
â”‚  ğŸ—‘ï¸ ì·¨ì†Œ ì´ë ¥ ì‚­ì œ               â†’ reservationIdë¡œ ì¡°íšŒ     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ëŒ€ìƒ í•¨ìˆ˜**: `cancelReservation()`, `deleteReservation()`

---

### âœ… AWS Best Practice ë¶€í•© ì—¬ë¶€

AWS DynamoDB ê³µì‹ Best Practiceì—ì„œ ê¶Œì¥í•˜ëŠ” íŒ¨í„´:

> **"ë‹¤ë¥¸ access patternì´ í•„ìš”í•˜ë©´ GSIë¥¼ ì‚¬ìš©í•˜ë¼"**

**MegaTicket ì¼€ì´ìŠ¤**:
- ê¸°ë³¸ ì¡°íšŒ: `PK`ë¡œ íšŒì°¨ë³„ ì¢Œì„ ì¡°íšŒ (PK ì‚¬ìš©)
- ì¶”ê°€ íŒ¨í„´ 1: `userId`ë¡œ ì‚¬ìš©ì ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ â† GSI ì í•©
- ì¶”ê°€ íŒ¨í„´ 2: `holdingId`ë¡œ ì„ ì  ì •ë³´ ì¡°íšŒ â† GSI ì í•©
- ì¶”ê°€ íŒ¨í„´ 3: `reservationId`ë¡œ ì˜ˆì•½ ì •ë³´ ì¡°íšŒ â† GSI ì í•©

---

### ğŸ“Š Scan vs Query with GSI ë¹„êµ

| í•­ëª© | Scan (ì´ì „) | Query + GSI (í˜„ì¬) |
|------|------------|-------------------|
| **RCU ì†Œë¹„** | ì „ì²´ í…Œì´ë¸” ìŠ¤ìº” (~1,250 RCU) | ì¡°íšŒ ê²°ê³¼ë§Œ (~1 RCU) |
| **ë¹„ìš©** | ë°ì´í„° ì¦ê°€ ì‹œ ë¹„ë¡€ ì¦ê°€ | ì¼ì • ìœ ì§€ |
| **ì‘ë‹µ ì†ë„** | O(n) - ëŠë¦¼ | O(1) - ë¹ ë¦„ |
| **í™•ì¥ì„±** | ë°ì´í„° ë§ì•„ì§€ë©´ ë¬¸ì œ | ë¬¸ì œì—†ìŒ |
| **10,000 ë ˆì½”ë“œ ì¤‘ 1ê±´ ì¡°íšŒ** | ~1,250 RCU | **~1 RCU (99% ì ˆê°)** |

---

### ğŸ’¡ WORM íŒ¨í„´ (Write Once, Read Many)

**"ë°ì´í„°ëŠ” í•œ ë²ˆ ì“°ê³ , ì—¬ëŸ¬ ë²ˆ ì½ëŠ”ë‹¤"**

ì´ê±´ ê±°ì˜ ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ê³µí†µì…ë‹ˆë‹¤:

| ì„œë¹„ìŠ¤ | ì“°ê¸° | ì½ê¸° |
|--------|------|------|
| í‹°ì¼“íŒ… | ì˜ˆì•½ 1íšŒ | ì¡°íšŒ 5~10íšŒ |
| ì‡¼í•‘ëª° | ì£¼ë¬¸ 1íšŒ | ë°°ì†¡ì¡°íšŒ 10íšŒ+ |
| SNS | ê¸€ ì‘ì„± 1íšŒ | ì¡°íšŒìˆ˜ 1000íšŒ+ |
| ì€í–‰ | ì´ì²´ 1íšŒ | ì”ì•¡ì¡°íšŒ 10íšŒ+ |

#### ì‚¬ìš©ì í–‰ë™ íŒ¨í„´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì‚¬ìš©ì Aì˜ ì—¬ì •                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1ï¸âƒ£ "ë‚´ ì˜ˆì•½ í™•ì¸í•´ì¤˜"           â†’ ì¡°íšŒ 1íšŒ                  â”‚
â”‚  2ï¸âƒ£ (ë‹¤ìŒë‚ ) "ì˜ˆì•½ ì˜ ëë‚˜?"     â†’ ì¡°íšŒ 1íšŒ                  â”‚
â”‚  3ï¸âƒ£ (ê³µì—° ì „ë‚ ) "ëª‡ ì‹œì§€?"       â†’ ì¡°íšŒ 1íšŒ                  â”‚
â”‚  4ï¸âƒ£ (ê³µì—° ë‹¹ì¼) "ì¢Œì„ ë²ˆí˜¸?"     â†’ ì¡°íšŒ 1íšŒ                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚  ì˜ˆì•½ 1ê±´ì— ì¡°íšŒ 4íšŒ ì´ìƒ!                                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ’° ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„

| í•­ëª© | ë³€í™” | ì„¤ëª… |
|------|------|------|
| **ì½ê¸° ë¹„ìš©** | â¬‡ï¸ ëŒ€í­ ì ˆê° | Scan â†’ Query (99% ì ˆê°) |
| **ì“°ê¸° ë¹„ìš©** | â¬†ï¸ ì†Œí­ ì¦ê°€ | GSI ë³µì œ ì‹œ ì¶”ê°€ WCU ë°œìƒ |
| **ì €ì¥ ë¹„ìš©** | â¬†ï¸ ì†Œí­ ì¦ê°€ | GSIì— ë°ì´í„° ë³µì œë¨ |

#### ë¹„ìš© ê³„ì‚° ì˜ˆì‹œ

```
ì“°ê¸° ë¹„ìš© ì¦ê°€: +20~30% (1íšŒ Ã— 1.3 = 1.3)
ì½ê¸° ë¹„ìš© ì ˆê°: -99%    (10íšŒ Ã— 0.01 = 0.1)
                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ ë¹„ìš©:        1.3 + 0.1 = 1.4 (ì´ì „: 1 + 10 = 11)
                â†’ ì•½ 87% ì ˆê°!
```

> ğŸ’¡ **ê²°ë¡ **: ì½ê¸°ê°€ ì“°ê¸°ë³´ë‹¤ ë§ì€ ì˜ˆì•½ ì¡°íšŒ íŒ¨í„´ì—ì„œëŠ” **ì „ì²´ì ìœ¼ë¡œ ë¹„ìš© ì ˆê°**

> ğŸ“ **Pilot Light ê´€ì **: DR ë¦¬ì „ì—ì„œë„ ë™ì¼ GSI êµ¬ì„± í•„ìš” (DynamoDB Global Tables ì‚¬ìš© ì‹œ ìë™ ë³µì œ)

---

### âœ… ì½”ë“œ ìˆ˜ì • ì™„ë£Œ (V7.15)

`holding-manager.ts`ì—ì„œ ëª¨ë“  Scan â†’ Query ë³€ê²½ ì™„ë£Œ:

| í•¨ìˆ˜ | ë³€ê²½ ì „ | ë³€ê²½ í›„ | GSI |
|------|--------|--------|-----|
| `getUserReservations()` | Scan | Query | `userId-index` |
| `getHolding()` | Scan | Query | `holdingId-index` |
| `releaseHolding()` | Scan | Query | `holdingId-index` |
| `confirmReservation()` | Scan | Query | `holdingId-index` |
| `cancelReservation()` | Scan | Query | `reservationId-index` |
| `deleteReservation()` | Scan | Query | `reservationId-index` |

```typescript
// V7.15 ì ìš© ì˜ˆì‹œ - confirmReservation()
const result = await dynamoDb.send(new QueryCommand({
    TableName: RESERVATIONS_TABLE,
    IndexName: 'holdingId-index',  // â† GSI ì‚¬ìš©
    KeyConditionExpression: "holdingId = :hid",
    FilterExpression: "#s = :s1 OR #s = :s2",
    ...
}));
```

---

### ğŸ”„ ì¢Œì„ ì‹¤ì‹œê°„ ì¡°íšŒ ì „ëµ (V7.15)

#### Polling ë¹„í™œì„±í™”ë¡œ ë¹„ìš© ì ˆê°

**íŒŒì¼**: `apps/web/components/seats/seat-map.tsx`

| í•­ëª© | ì´ì „ | ë³€ê²½ í›„ (V7.15) |
|------|------|-----------------|
| 3ì´ˆ ìë™ Polling | âœ… í™œì„±í™” | âŒ **ì£¼ì„ ì²˜ë¦¬** |
| ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ | âœ… ë™ì‘ | âœ… ë™ì‘ |
| `REFRESH_SEAT_MAP` ì´ë²¤íŠ¸ | âœ… ë™ì‘ | âœ… ë™ì‘ |

#### í˜„ì¬ ê°±ì‹  ë°©ë²•

1. **ìˆ˜ë™**: ìš°ì¸¡ ìƒë‹¨ `ìƒˆë¡œê³ ì¹¨` ë²„íŠ¼ í´ë¦­
2. **ìë™**: ì„ ì /ì˜ˆì•½ ì™„ë£Œ í›„ `REFRESH_SEAT_MAP` ì´ë²¤íŠ¸ ë°œìƒ ì‹œ

#### ë¹„ìš© ë¹„êµ

```
3ì´ˆ Polling (ì´ì „):
â”œâ”€â”€ ì‚¬ìš©ì 1ëª… Ã— 10ë¶„ ì ‘ì† = 200íšŒ ì¡°íšŒ
â”œâ”€â”€ 200 Ã— 1 RCU = 200 RCU
â””â”€â”€ ë™ì‹œ ì ‘ì† 100ëª… = 20,000 RCU / 10ë¶„

ë²„íŠ¼ í´ë¦­ (í˜„ì¬):
â”œâ”€â”€ ì‚¬ìš©ì 1ëª… Ã— í‰ê·  3íšŒ í´ë¦­ = 3íšŒ ì¡°íšŒ
â”œâ”€â”€ 3 Ã— 1 RCU = 3 RCU
â””â”€â”€ ë™ì‹œ ì ‘ì† 100ëª… = 300 RCU / 10ë¶„

ğŸ’° ì ˆê°ë¥ : 98.5%
```

#### í…ŒìŠ¤íŠ¸ ì‹œ ë‹¤ì‹œ í™œì„±í™”

```typescript
// seat-map.tsx Line 136-141
// V7.15: 3ì´ˆ ìë™ Polling ë¹„í™œì„±í™” (DB ë¹„ìš© ì ˆê°)
// í…ŒìŠ¤íŠ¸ ì‹œ ì•„ë˜ ì£¼ì„ í•´ì œí•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥
/*                          â† ì‚­ì œ
const interval = setInterval(() => {
    fetchVenueData(true);
}, 3000);
*/                          â† ì‚­ì œ
```

---

## ğŸ“¦ ë¹„ì •ê·œí™” (Denormalization) ì „ëµ

### ë¹„ì •ê·œí™”ë€?

**ì •ê·œí™” (Normalization)**:
- ë°ì´í„° ì¤‘ë³µ ì œê±°, í…Œì´ë¸” ë¶„ë¦¬
- ì¡°íšŒ ì‹œ JOIN í•„ìš” â†’ **DynamoDBì—ì„œëŠ” JOIN ë¶ˆê°€ëŠ¥**

**ë¹„ì •ê·œí™” (Denormalization)**:
- ì˜ë„ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³µì‚¬/ì¤‘ë³µ ì €ì¥
- ë‹¨ì¼ ì¿¼ë¦¬ë¡œ í•„ìš”í•œ ëª¨ë“  ë°ì´í„° íšë“ â†’ **DynamoDB ìµœì í™” íŒ¨í„´**

### ì™œ ë¹„ì •ê·œí™”ê°€ í•„ìš”í•œê°€?

```
âŒ RDB ë°©ì‹ (JOIN í•„ìš”):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reservations â”‚â”€â”€â”€â”€â–¶â”‚ performances â”‚  â†’ 2ë²ˆ ì¡°íšŒ í•„ìš”
â”‚ performanceIdâ”‚     â”‚    title     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… DynamoDB ë°©ì‹ (ë¹„ì •ê·œí™”):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         reservations            â”‚
â”‚ performanceId + performanceTitle â”‚  â†’ 1ë²ˆ ì¡°íšŒë¡œ ì™„ë£Œ
â”‚         (ë³µì‚¬í•´ì„œ ì €ì¥)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¹„ì •ê·œí™” ì ìš© í˜„í™©

| í…Œì´ë¸” | ë¹„ì •ê·œí™” í•„ë“œ | ì›ë³¸ í…Œì´ë¸” | ë³µì‚¬ ì‹œì  | ëª©ì  |
|-------|-------------|------------|----------|------|
| **reservations** | `performanceTitle` | performances.title | CONFIRMED ì‹œ | ì˜ˆì•½ ì¡°íšŒ ì‹œ JOIN ì—†ì´ ê³µì—°ëª… í‘œì‹œ |
| **reservations** | `venue` | venues.name | CONFIRMED ì‹œ | ì˜ˆì•½ ì¡°íšŒ ì‹œ ê³µì—°ì¥ëª… í‘œì‹œ |
| **reservations** | `posterUrl` | performances.posterUrl | CONFIRMED ì‹œ | ì˜ˆì•½ ëª©ë¡ì—ì„œ í¬ìŠ¤í„° í‘œì‹œ |

| **performances** | `venue` (ì´ë¦„) | venues.name | ê³µì—° ë“±ë¡ ì‹œ | ê³µì—° ìƒì„¸ì—ì„œ ê³µì—°ì¥ëª… í‘œì‹œ |

### ë¹„ì •ê·œí™”ì˜ Trade-off

| ì¥ì  | ë‹¨ì  |
|------|------|
| âœ… ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ (1ë²ˆ ì¿¼ë¦¬) | âš ï¸ ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ì¦ê°€ |
| âœ… RCU ë¹„ìš© ì ˆê° | âš ï¸ ì›ë³¸ ë³€ê²½ ì‹œ ë™ê¸°í™” í•„ìš” |
| âœ… ì½”ë“œ ë‹¨ìˆœí™” (JOIN ë¶ˆí•„ìš”) | âš ï¸ ë°ì´í„° ì¼ê´€ì„± ê´€ë¦¬ |

### ë¹„ìš© ìµœì í™” ê´€ì 

```
ì½ê¸° 1íšŒ ë¹„ìš©: 0.25 RCU (4KB)
ì“°ê¸° 1íšŒ ë¹„ìš©: 1.0 WCU (1KB)

ì˜ˆì•½ ì¡°íšŒ ì‹œë‚˜ë¦¬ì˜¤ (10,000íšŒ/ì¼):
- JOIN ë°©ì‹: 2ë²ˆ ì½ê¸° Ã— 10,000 = 20,000 RCU
- ë¹„ì •ê·œí™”: 1ë²ˆ ì½ê¸° Ã— 10,000 = 10,000 RCU â†’ 50% ì ˆê°

ì›ë³¸ ë³€ê²½ ì‹œë‚˜ë¦¬ì˜¤ (10íšŒ/ì¼):
- ì¶”ê°€ ì“°ê¸°: 10íšŒ Ã— ê´€ë ¨ ë ˆì½”ë“œ â†’ ë¯¸ë¯¸í•œ ë¹„ìš©

ê²°ë¡ : ì½ê¸° >> ì“°ê¸° íŒ¨í„´ì—ì„œ ë¹„ì •ê·œí™”ê°€ ìœ ë¦¬
```

### ë°ì´í„° ì¼ê´€ì„± ê´€ë¦¬

| ì‹œë‚˜ë¦¬ì˜¤ | ì²˜ë¦¬ ë°©ì‹ |
|---------|----------|
| ê³µì—°ëª… ë³€ê²½ | ë§¤ìš° ë“œë¬¾ (ì‚¬ì „ ê³µì§€ í›„ ë³€ê²½) â†’ ìˆ˜ë™ ë§ˆì´ê·¸ë ˆì´ì…˜ |
| ê³µì—°ì¥ëª… ë³€ê²½ | ê±°ì˜ ì—†ìŒ â†’ ë¬¸ì œ ì‹œ ìˆ˜ë™ ì²˜ë¦¬ |
| í¬ìŠ¤í„° ë³€ê²½ | ë“œë¬¾ â†’ confirmedAt ì´í›„ ì˜ˆì•½ì€ ìˆ˜ë™ ì—…ë°ì´íŠ¸ |

> ğŸ“ **ì„¤ê³„ ì›ì¹™**: ë³€ê²½ ë¹ˆë„ê°€ ë‚®ì€ ë°ì´í„°ë§Œ ë¹„ì •ê·œí™” + ì½ê¸° ë¹ˆë„ê°€ ë†’ì€ ì¡°íšŒ ìµœì í™”

### ì¸í”„ë¼ ê´€ì  ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DynamoDB ìµœì í™” 3ëŒ€ ì›ì¹™                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1ï¸âƒ£ GSI: ë‹¤ë¥¸ access patternì— ëŒ€ì‘                          â”‚
â”‚     â””â”€â”€ userId-index ì¶”ê°€ â†’ ì‚¬ìš©ìë³„ ì¡°íšŒ ìµœì í™”              â”‚
â”‚                                                             â”‚
â”‚  2ï¸âƒ£ ë¹„ì •ê·œí™”: JOIN ì—†ì´ ë‹¨ì¼ ì¿¼ë¦¬ ì™„ë£Œ                        â”‚
â”‚     â””â”€â”€ performanceTitle, venue ë“± reservationsì— ë³µì‚¬       â”‚
â”‚                                                             â”‚
â”‚  3ï¸âƒ£ ì¸ë©”ëª¨ë¦¬ ìºì‹±: ì •ì  ë°ì´í„° DB ì¡°íšŒ ìµœì†Œí™”                  â”‚
â”‚     â””â”€â”€ performances, schedules, venues ìºì‹± (7ì¼ TTL)      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì¸ë©”ëª¨ë¦¬ ìºì‹± ìƒì„¸ (7ì¼ TTL)

#### ì ìš© ì´ìœ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âŒ ìºì‹± ë¯¸ì ìš© ì‹œ ë¬¸ì œì                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ì±—ë´‡ ëŒ€í™” 1íšŒ ì‹œ:                                           â”‚
â”‚  - get_performances: 1 RCU                                  â”‚
â”‚  - get_seat_grades: 1 RCU                                   â”‚
â”‚  - get_schedules: 1 RCU                                     â”‚
â”‚  - get_venue_info: 1 RCU                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  í•©ê³„: 4+ RCU/ëŒ€í™”                                          â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° ì¼ 1,000íšŒ ëŒ€í™” ì‹œ:                                      â”‚
â”‚  - 4,000+ RCU ì†Œëª¨                                          â”‚
â”‚  - ì›”ê°„ 120,000+ RCU                                        â”‚
â”‚  - ë¶ˆí•„ìš”í•œ ë¹„ìš© ë°œìƒ!                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âœ… ì¸ë©”ëª¨ë¦¬ ìºì‹± ì ìš© ì‹œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ì •ì  ë°ì´í„° íŠ¹ì„±:                                           â”‚
â”‚  - ê³µì—° ì •ë³´: ê±°ì˜ ë³€ê²½ ì•ˆ ë¨                                 â”‚
â”‚  - ê³µì—°ì¥ ì •ë³´: ê±°ì˜ ë³€ê²½ ì•ˆ ë¨                               â”‚
â”‚  - ì¢Œì„ ë“±ê¸‰/ê°€ê²©: ê³µì—° ê¸°ê°„ ì¤‘ ê³ ì •                          â”‚
â”‚                                                             â”‚
â”‚  ìºì‹± ì „ëµ:                                                  â”‚
â”‚  - TTL 7ì¼ ì„¤ì • â†’ ì¼ì£¼ì¼ê°„ ë©”ëª¨ë¦¬ì— ìœ ì§€                      â”‚
â”‚  - ì²« ìš”ì²­ ì‹œ DB ì¡°íšŒ â†’ ìºì‹œ ì €ì¥                            â”‚
â”‚  - ì´í›„ ìš”ì²­ì€ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ ì‘ë‹µ                           â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° ë¹„ìš© ì ˆê°:                                               â”‚
â”‚  - RCU 99%+ ì ˆê° (ì •ì  ë°ì´í„°)                               â”‚
â”‚  - ì‘ë‹µ ì†ë„ í–¥ìƒ (DB ì™•ë³µ ì œê±°)                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìºì‹± ëŒ€ìƒ í…Œì´ë¸”

| í…Œì´ë¸” | ìºì‹± ì—¬ë¶€ | TTL | ì´ìœ  |
|--------|----------|-----|------|
| `performances` | âœ… ìºì‹± | 7ì¼ | ê³µì—° ì •ë³´ ê±°ì˜ ë³€ê²½ ì•ˆ ë¨ |
| `schedules` | âœ… ìºì‹± | 7ì¼ | ìŠ¤ì¼€ì¤„ ê³ ì • (ì¶”ê°€ë§Œ ìˆìŒ) |
| `venues` | âœ… ìºì‹± | 7ì¼ | ê³µì—°ì¥ ì •ë³´ ë³€ê²½ ì—†ìŒ |
| `reservations` | âŒ ì‹¤ì‹œê°„ | - | ì¢Œì„ ìƒíƒœ ì‹¤ì‹œê°„ ë³€ê²½ |

#### êµ¬í˜„ ìœ„ì¹˜

```typescript
// ğŸ“ apps/app/lib/server/performance-service.ts

const performanceCache = new Map<string, { data: Performance; timestamp: number }>();
const CACHE_TTL = 7 * 24 * 60 * 60 * 1000; // 7ì¼

function getCachedPerformance(id: string): Performance | null {
    const cached = performanceCache.get(id);
    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
        return cached.data;  // ìºì‹œ íˆíŠ¸ â†’ DB ì¡°íšŒ ì—†ìŒ
    }
    return null;  // ìºì‹œ ë¯¸ìŠ¤ â†’ DB ì¡°íšŒ í•„ìš”
}
```

---

## ğŸŒ Global Tables (DR ë³µì œ) ì„¤ì • í˜„í™©

### ë³µì œ ë¦¬ì „ êµ¬ì„±

| Main ë¦¬ì „ | DR ë¦¬ì „ | ìƒíƒœ |
|----------|---------|------|
| `ap-northeast-2` (ì„œìš¸) | `ap-northeast-1` (ë„ì¿„) | âœ… **ACTIVE** |

### ë³µì œ ëŒ€ìƒ í…Œì´ë¸”

| í…Œì´ë¸”ëª… | ë³µì œ ìƒíƒœ | GSI ë³µì œ |
|---------|----------|----------|
| `KDT-Msp4-PLDR-performances` | âœ… ìë™ ë³µì œ | - |
| `KDT-Msp4-PLDR-reservations` | âœ… ìë™ ë³µì œ | `userId-index`, `holdingId-index`, `reservationId-index` ìë™ í¬í•¨ |
| `KDT-Msp4-PLDR-schedules` | âœ… ìë™ ë³µì œ | `performanceId-index` ìë™ í¬í•¨ |
| `KDT-Msp4-PLDR-venues` | âœ… ìë™ ë³µì œ | - |

> ğŸ“ **Global Tables íŠ¹ì§•**: GSIëŠ” ë³„ë„ ì„¤ì • ì—†ì´ ìë™ ë³µì œë©ë‹ˆë‹¤.

---

## âœ… ì¸í”„ë¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ (2025-12-28 V7.15 ì™„ë£Œ)

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|-----|------|------|
| `userId-index` GSI (reservations) | âœ… í™œì„± + ì½”ë“œ ì ìš© ì™„ë£Œ | getUserReservations() |
| `holdingId-index` GSI (reservations) | âœ… í™œì„± + ì½”ë“œ ì ìš© ì™„ë£Œ | getHolding(), releaseHolding(), confirmReservation() |
| `reservationId-index` GSI (reservations) | âœ… í™œì„± + ì½”ë“œ ì ìš© ì™„ë£Œ | cancelReservation(), deleteReservation() |
| `performanceId-index` GSI (schedules) | âœ… ì´ë¯¸ ì‚¬ìš© ì¤‘ | - |
| Global Tables (ë„ì¿„ DR) | âœ… ACTIVE | ëª¨ë“  GSI ìë™ ë³µì œ |
| ì¸ë©”ëª¨ë¦¬ ìºì‹± | âœ… ì ìš©ë¨ | 7ì¼ TTL |
| ë¹„ì •ê·œí™” ì „ëµ | âœ… ì ìš©ë¨ | reservationsì— ê³µì—° ì •ë³´ ë³µì‚¬ |

> ğŸ‰ **DB ê´€ë ¨ ì¸í”„ë¼/ì½”ë“œ ì‘ì—… ëª¨ë‘ ì™„ë£Œ! (V7.15)**
