# 🚨 V7.13 Critical 버그 리포트

> **긴급도**: Critical  
> **발견일**: 2025-12-27  
> **원칙**: 하드코딩 절대 금지, DynamoDB가 Single Source of Truth

---

## 📋 버그 목록

| 순위 | 항목 | 긴급도 |
|------|------|--------|
| 1 | 예약 확정 API 오류 | 🔴 Critical |
| 2 | 열(row) 정보 누락 | 🔴 Critical |
| 3 | B구역 좌석 수 복구 | 🟠 High |
| 4 | 열 번호 오류 (2열 시작) | 🟠 High |
| 5 | 2층 위치 조정 | 🟡 Medium |
| 6 | 좌석 표기 형식 개선 | 🟡 Medium |

---

## 🔴 Critical #1: 예약 확정 API 오류

**현상**: "결제 및 예약 확정" 버튼 클릭 시 **"예약 확정 중 오류가 발생했습니다"** 에러

**재현 경로**:
1. 좌석 선택 → 예매하기
2. 결제 화면 진입 (`/reservation/confirm?holdingId=...`)
3. "결제 및 예약 확정" 버튼 클릭
4. ❌ 오류 발생

**요청**: 
- 백엔드 콘솔 로그 확인
- API 응답 에러 메시지 확인
- 원인 파악 후 수정

---

## 🔴 Critical #2: 열(row) 정보 누락

**현상**: 
- 좌석 배치도에서 좌석 hover 시 **`?열`** 로 표시됨
- 예약 확인 페이지에서 **"OP석 열 9번"** 처럼 열 번호 누락

**원인 추정**: 
- DB 데이터 파싱 오류
- `rowId` 또는 `rowNumber`가 제대로 저장/조회되지 않음

**정상 표기 예시**: `1층 B구역 5열 12번 (VIP석)`

---

## 🟠 High #3: 1층 B구역 좌석 배치 복구

**현상**: B구역 좌석 수가 의도치 않게 변경됨

**문제**: A/C 구역만 비정형화하기로 했는데 **B구역까지 변경**됨

**복구 요청**:

| 열 | 현재 (잘못됨) | 복구할 좌석 수 |
|----|--------------|---------------|
| OP열 | ? | **12좌석** (유지) |
| 1열~17열 | ? | **14좌석** (이전 상태로 복구) |

**수정 위치**: `restore-venue-sections.mjs` - B구역 로직 분리 필요

---

## 🟠 High #4: 1층 열 번호 오류 (OP → 2열 시작)

**현상**: OP열 다음이 **1열**이어야 하는데 **2열부터 시작**됨

**정상 흐름**:
```
OP열 → 1열 → 2열 → 3열 → ... → 17열
```

**현재 (오류)**:
```
OP열 → 2열 → 3열 → ... (1열 누락)
```

**원인 추정**: `restore-venue-sections.mjs` 스크립트에서 B구역 rowId 생성 시 인덱스 오류

---

## 🟡 Medium #5: 2층 좌석 배치 위치 조정

**현상**: 2층 좌석 배치가 너무 앞으로 와있음

**요청**: 
- 2층 D/E/F 구역 시작 위치를 뒤로 조정
- 첨부 이미지에서 빨간 선 위치 참고

**수정 위치**: CSS 또는 `theater-template.tsx` 렌더링 로직

---

## 🟡 Medium #6: 예약 확인 페이지 좌석 표기 개선

**현재 표기** (문제):
```
OP석 열 9번        170,000원
VIP석 열 12번      170,000원
S석 열 7번         110,000원
A석 열 11번         80,000원
```

**요청 형식**:
```
1층 B구역 OP열 9번 (OP석)      170,000원
1층 B구역 5열 12번 (VIP석)     170,000원
2층 E구역 7열 11번 (S석)       110,000원
2층 E구역 11열 15번 (A석)       80,000원
```

**수정 위치**: 예약 확인 페이지 컴포넌트 (좌석 정보 렌더링 부분)

---

## 🔍 디버깅 체크리스트

### 1. 예약 확정 API
- [ ] `npm run dev` 실행 후 터미널 에러 로그 확인
- [ ] 브라우저 개발자 도구 → Network 탭 → API 응답 확인
- [ ] DynamoDB `reservations` 테이블 데이터 확인

### 2. 열(row) 정보
- [ ] `venues` 테이블 → `sections` 필드 → 각 row의 `rowId`, `rowNumber` 확인
- [ ] 프론트엔드에서 row 데이터 파싱 로직 확인

### 3. B구역 좌석 수
- [ ] `restore-venue-sections.mjs` 에서 B구역 로직 확인
- [ ] A/C 구역과 B구역 로직 분리 여부 확인

---

## ⚠️ 핵심 원칙 재확인

```
✅ 하드코딩 절대 금지
✅ DynamoDB `sections` = Single Source of Truth
✅ 프론트엔드는 DB 데이터를 그대로 렌더링
✅ A/C 구역만 비정형화, B구역은 기존 14좌석 유지
✅ 데이터 플로우: restore-venue-sections.mjs → DynamoDB → 프론트엔드
```

---

## 📎 참고 이미지

1. **Before 이미지**: 1층 좌석 배치 (이전 상태)
2. **2층 이미지**: 빨간 선 위치까지 뒤로 조정 필요
3. **예약 확인 페이지**: 좌석 표기 형식 문제
4. **에러 화면**: "예약 확정 중 오류가 발생했습니다"

---

**가장 치명적인 예약 확정 API 오류부터 확인 부탁드립니다!**
